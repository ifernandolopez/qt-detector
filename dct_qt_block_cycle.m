function [Br, has_truncated] = dct_qt_block_cycle(B,Ts,round_block)% Perform the whole cycle DCT2-quantization-dequantization-IDCT2 to a block% see dct_qt.pdf% Returns Br - the reconstructed block%         has_truncated - indicates is some of the values of Br has been%                         truncated to the range 0..255%                         This truncation occurs only when round_block==true% Default parameters valuesif (nargin<3)  round_block = true;end% 1. Level on to -128..127 rangeB = int32(B)-128;% 2. DCT representation of the blocksglobal A;if (isempty(A))   A = dctmtx(8);endC = A*double(B)*A'; % 3. Coefficients quantizationCq = C./Ts;% 4. Coefficients rounding to obtain the JPEG coefficientsCj = int32(Cq);% 5. Coefficients dequantizationCr = Cj.*int32(Ts);% 6. Real value reconstructed blockAr = A'*double(Cr)*A;% 7. Reconstructed block if (round_block==true)  has_truncated = (min(min(Ar))<-128 || max(max(Ar))>127 );  % Level off to 0..255  Br = uint8(Ar+128);else  has_truncated = false;  Br = Ar+128;end